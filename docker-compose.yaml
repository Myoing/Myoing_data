###############################################################
# âœ… í†µí•© Compose ì¥ì 
# í•­ëª©             ì„¤ëª…
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ìš´ì˜ ì¼ì›í™”       ë‹¨ì¼ ëª…ë ¹ì–´ë¡œ ì „ì²´ ì‹œìŠ¤í…œ up/down ê°€ëŠ¥
# ë²„ì „ ê´€ë¦¬ í†µì¼    í•˜ë‚˜ì˜ compose.ymlë¡œ ì „ì²´ ì„œë¹„ìŠ¤ ìƒíƒœ ì¶”ì  ê°€ëŠ¥
# CI/CD í†µí•© ì‰¬ì›€   GitHub Actionsì—ì„œ ì „ì²´ ì¸í”„ë¼ ì œì–´ ìš©ì´
# í™˜ê²½ ë¶„ë¦¬ ê°€ëŠ¥    í•„ìš” ì‹œ .env, --profile, -f ì˜µì…˜ìœ¼ë¡œ dev/prod ë¶„ë¦¬ ê°€ëŠ¥
#
# â— ì£¼ì˜í•  ì 
# - ê¸°ì¡´ myoing-backend ë˜ëŠ” frontend ë ˆí¬ì—ì„œ ì‚¬ìš©í•˜ë˜ ê°œë³„ Composeê°€ ìˆë‹¤ë©´
#   í•´ë‹¹ ì •ì˜ëŠ” ì œê±°í•˜ê±°ë‚˜, ì„œë¸Œ ëª¨ë“ˆë¡œ ë¶„ë¦¬í•´ì•¼ ì¶©ëŒ ë°©ì§€ ê°€ëŠ¥
# - Docker image/tag ê´€ë¦¬ ì „ëµì„ ëª…í™•íˆ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤
#   (ì˜ˆ: latest ëŒ€ì‹  ë²„ì „ ëª…ì‹œë¥¼ ê¶Œì¥)
#
# ğŸ”š ê²°ë¡ 
# ë„¤, myoing-data ë ˆí¬ì— ìˆëŠ” docker-compose.ymlì„ ì „ì²´ ì‹œìŠ¤í…œ ì œì–´ì˜ 
# ì¤‘ì•™ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì‚¼ëŠ” ê²ƒì€ ì¶©ë¶„íˆ ê°€ëŠ¥í•˜ë©°,
# ì˜¤íˆë ¤ ìš´ì˜ ì¼ê´€ì„±ê³¼ ë°°í¬ ìë™í™”ì— ìœ ë¦¬í•©ë‹ˆë‹¤.
###############################################################

version: "3.9"

services:
  myoing-mysql:
    image: mysql:8
    container_name: myoing-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 4321
      MYSQL_DATABASE: myoing_db
      MYSQL_USER: myoing_user
      MYSQL_PASSWORD: myoing_4321
    ports:
      - "3306:3306"
    volumes:
      - myoing_mysql_data:/var/lib/mysql
    networks:
      - myoing-net

  myoing-data:
    image: myoing/myoing-data:latest
    container_name: myoing-data
    restart: always
    depends_on:
      - myoing-mysql
    volumes:
      - data_shared:/app/data
    environment:
      - DB_USER=myoing_user
      - DB_PASSWORD=myoing_4321
      - DB_HOST=myoing-mysql
      - DB_PORT=3306
      - DB_NAME=myoing_db
    networks:
      - myoing-net

  myoing-ml:
    image: myoing/myoing-ml:latest
    container_name: myoing-ml
    restart: always
    depends_on:
      - myoing-data
    volumes:
      - data_shared:/app/data
      - ml_output:/app/output
    ports:
      - "8088:8088"
    networks:
      - myoing-net

  springboot-app:
    image: myoing/myoing-backend:latest
    container_name: springboot-app
    restart: always
    depends_on:
      - myoing-mysql
      - myoing-ml
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://myoing-mysql:3306/myoing_db?useSSL=false&serverTimezone=Asia/Seoul
      SPRING_DATASOURCE_USERNAME: myoing_user
      SPRING_DATASOURCE_PASSWORD: myoing_4321
      ML_URL: http://myoing-ml:8088
    networks:
      - myoing-net

  myoing-frontend:
    image: myoing/myoing-frontend:latest
    container_name: myoing-frontend
    restart: always
    depends_on:
      - springboot-app
    ports:
      - "3000:80"
    networks:
      - myoing-net

networks:
  myoing-net:
    driver: bridge

volumes:
  myoing_mysql_data:
  data_shared:
  ml_output: